<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essencia</title>
    <link rel="stylesheet" href="./css/tienda.css">
    <style>
        
    </style>
</head>
<body>
    <header>
        <div class="logo">Essencia</div>
        <nav>
            <a href="#inicio" onclick="showSection('inicio')">Inicio</a>
            <a href="#productos" onclick="showSection('productos')">Productos</a>
            <a href="#ofertas" onclick="showSection('ofertas')">Ofertas</a>
            <a href="#contacto" onclick="showSection('contacto')">Contacto</a>
            <a href="#carrito" onclick="showSection('carrito')">Carrito</a>
        </nav>
        <button class="btn-cerrar-sesion" onclick="toggleModal()">⚙</button>
    </header>
    <section id="inicio" class="active">
        <p>Inicio</p>
    </section>
    <section id="productos">
        <center>
        <div>
            <input type="text" id="busqueda" placeholder="Buscar productos..." oninput="filtrarProductos()">
            <label for="categoria">Categoría:</label>
            <select id="categoria" onchange="filtrarProductos()">
                <option value="">Todas</option>
                <option value="camisetas">Camisetas</option>
                <option value="pantalones">Pantalones</option>
                <option value="chaquetas">Chaquetas</option>
                <option value="zapatos">Zapatos</option>
                <option value="accesorios">Accesorios</option>
                <option value="camisas">Camisas</option>
                <option value="blusas">Blusas</option>
                <option value="faldas">Faldas</option>
                <option value="chaquetas_de_denim">Chaquetas de Denim</option>
                <option value="abrigo">Abrigo</option>
                <option value="chalecos">Chalecos</option>
                <option value="trajes">Trajes</option>
                <option value="pantalones_cortos">Pantalones Cortos</option>
                <option value="leggings">Leggings</option>
                <option value="bufandas">Bufandas</option>
                <option value="guantes">Guantes</option>
                <option value="sombreros">Sombreros</option>
                <option value="gorros">Gorros</option>
                <option value="cinturones">Cinturones</option>
                <option value="calcetines">Calcetines</option>
                <option value="ropa_de_deporte">Ropa de Deporte</option>
                <option value="batas">Batas</option>
                <option value="ropas_de_cama">Ropas de Cama</option>
            </select>
            <label for="precio">Precio máximo:</label>
            <input type="number" id="precio" placeholder="Precio máximo" oninput="filtrarProductos()">
        </div>
    </center>
    <br>
        <div id="productosContainer"></div>
    </section>
    
    

    <section id="ofertas">
        <p>Ofertas</p>
    </section>
    <section id="contacto">
        <h2>¡Contáctanos!</h2>
        <p>Estamos aquí para ayudarte con cualquier consulta o comentario. No dudes en ponerte en contacto con nosotros a través de los siguientes medios:</p>
        
        <div class="info-container">
            <div class="info-box direccion">
                <i class="fas fa-map-marker-alt"></i>
                <h3>Dirección</h3>
                <p>123 Calle Principal<br>Ciudad, País, 12345</p>
            </div>
            <div class="info-box telefono">
                <i class="fas fa-phone-alt"></i>
                <h3>Teléfono</h3>
                <p>(+123) 456-7890</p>
            </div>
            <div class="info-box email">
                <i class="fas fa-envelope"></i>
                <h3>Correo Electrónico</h3>
                <p>contacto@ejemplo.com</p>
            </div>
        </div>
        
        <form>
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" name="email" required>

            <label for="mensaje">Mensaje:</label>
            <textarea id="mensaje" name="mensaje" rows="4" required></textarea>

            <button type="submit">Enviar</button>
        </form>
    </section>

    <section id="carrito">
        <h2>Carrito de Compras</h2>
        <div id="carritoContainer">
            <ul id="carritoList"></ul>
            <p id="total">Total: $0.00</p>
            <!-- Botón para vaciar el carrito -->
            <button id="vaciarCarrito" onclick="vaciarCarrito()">Vaciar Carrito</button>
        </div>
    </section>
    

    <!-- Ventana emergente para cerrar sesión -->
    <div id="modalCerrarSesion" class="modal">
        <div class="modal-content">
            <p>¿Estás seguro de que quieres cerrar sesión?</p>
            <button class="confirmar" onclick="cerrarSesion()">Cerrar sesión</button>
            <button class="cancelar" onclick="toggleModal()">Cancelar</button>
        </div>
    </div>

    <script>
        // Verificar si el usuario está autenticado
        if (localStorage.getItem('autenticado') !== 'true') {
            alert('Debes iniciar sesión para acceder a esta página.');
            window.location.href = './cliente_login.html'; // Redirigir a la página de login
        }
    
        function showSection(sectionId) {
            const sections = document.querySelectorAll('section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }
    
        function toggleModal() {
            const modal = document.getElementById('modalCerrarSesion');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }
    
        function cerrarSesion() {
            localStorage.removeItem('autenticado');
            alert('Has cerrado sesión');
            window.location.href = './cliente_login.html'; // Redirigir a la página de login
        }
    
        // Funciones para manejar los productos y el carrito
        let productos = [];
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    
        function cargarProductos() {
            fetch('./json/productos.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('No se pudo cargar el archivo JSON');
                    }
                    return response.json();
                })
                .then(data => {
                    if (Array.isArray(data)) {
                        productos = data.map(producto => ({
                            ...producto,
                            precio: parseFloat(producto.precio),
                            cantidad: parseInt(producto.cantidad)
                        }));
                        mostrarProductos(); // Mostrar productos inicialmente
                    } else {
                        console.error('Formato de JSON incorrecto');
                    }
                })
                .catch(error => {
                    console.error('Error al cargar productos:', error);
                });
        }
    
        function filtrarProductos() {
            const busqueda = document.getElementById('busqueda').value.toLowerCase();
            const categoria = document.getElementById('categoria').value;
            const precioMaximo = parseFloat(document.getElementById('precio').value) || Infinity;
    
            const productosFiltrados = productos.filter(producto => {
                const nombreCoincide = producto.nombre.toLowerCase().includes(busqueda);
                const categoriaCoincide = categoria ? producto.categoria === categoria : true;
                const precioCoincide = producto.precio <= precioMaximo;
    
                return nombreCoincide && categoriaCoincide && precioCoincide;
            });
    
            mostrarProductos(productosFiltrados);
        }
    
        function mostrarProductos(listaProductos = productos) {
            const productosContainer = document.getElementById('productosContainer');
            productosContainer.innerHTML = '';
    
            listaProductos.forEach((producto, index) => {
                const productoDiv = document.createElement('div');
                productoDiv.className = 'producto';
                productoDiv.innerHTML = `
                    <img src="./productos_img/${producto.imagen}" alt="${producto.nombre}">
                    <div>
                        <h3>${producto.nombre}</h3>
                        <p><strong>Descripción:</strong> ${producto.descripcion}</p>
                        <p><strong>Precio:</strong> ${producto.precio} $</p>
                        <p><strong>Cantidad Disponible:</strong> ${producto.cantidad}</p>
                        <button onclick="agregarAlCarrito(${index})">Agregar al Carrito</button>
                    </div>
                `;
                productosContainer.appendChild(productoDiv);
            });
        }
    
        function agregarAlCarrito(index) {
            const producto = productos[index];
            const productoEnCarrito = carrito.find(p => p.nombre === producto.nombre);
    
            if (productoEnCarrito) {
                productoEnCarrito.cantidad += 1;
            } else {
                carrito.push({...producto, cantidad: 1});
            }
    
            localStorage.setItem('carrito', JSON.stringify(carrito));
            mostrarCarrito();
        }
    
        function mostrarCarrito() {
            const carritoList = document.getElementById('carritoList');
            const totalElement = document.getElementById('total');
            carritoList.innerHTML = '';
    
            let total = 0;
    
            carrito.forEach(item => {
                const itemLi = document.createElement('li');
                itemLi.innerHTML = `
                    <img src="./productos_img/${item.imagen}" alt="${item.nombre}">
                    <p>${item.nombre} - Cantidad: ${item.cantidad}</p>
                    <p>$${(item.precio * item.cantidad).toFixed(2)}</p>
                `;
                carritoList.appendChild(itemLi);
    
                total += item.precio * item.cantidad;
            });
    
            totalElement.textContent = `Total: $${total.toFixed(2)}`;
        }
    
        function vaciarCarrito() {
            carrito = []; // Vaciar el array del carrito
            localStorage.setItem('carrito', JSON.stringify(carrito)); // Actualizar en localStorage
            mostrarCarrito(); // Actualizar la vista del carrito
        }
    
        // Mostrar carrito al cargar la página
        mostrarCarrito();
    
        // Cargar productos al iniciar
        cargarProductos();
    </script>
    
</body>
</html>
